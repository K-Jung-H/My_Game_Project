유니티를 모방하여 게임 엔진 만들기



작업 완료

Scene 클래스를 작성하고 관리하는 구조를 완성

계층구조 Update 로직 작성 및 동작 테스트 완료

자주 쓰는 행렬 연산을 DXMathUtils.h 에 정리

모델 Load 방식 Assimp/FBX\_SDK 혼합 사용 적용

GameTimer 추가

입력을 저장, 처리하는 InputManager 구현

WindowMessage를 처리하는 플로우 완성

물리적 움직임(속력/가속도/충돌) 담당 RigidbodyComponent 구현 완료

입력에 따른 dt 기반 카메라 움직임 추가

Scene에 GameObject를 저장하는 컨테이너 역할 추가

무조건 ObjectManager를 통해 Object를 생성하도록 권한 설정 // ID 기반 관리 및 동시 생성 및 접근 대응

조명 Component 및 연산 추가 - 다중 조명 테스트 완료
- Cluster Light 연산을 이용한 조명 연산 최적화



할 일:

1):
---------------------
그림자 추가하기
	- Test Scene에 환경 객체를 추가하여, 그림자가 명확하게 나타나도록 환경을 조성하기
	- 택스쳐를 리소스 힙 주소영역 기반으로 바인딩 하는 방식을 활용하여, 기존 리소스 힙에 ShadowMap을 저장하는 고정 영역을 할당하고, 해당 영역을 바인딩 하기
		- Composite Pass 에서 ShadowMap 뿐만 아니라, 조명 정보 배열을 함께 바인딩 해야 함
			- 조명, 그림자 사이에 추가적인 연결 정보가 필요함
				- 해당 그림자는 어떤 조명과 연산 되어야 하는지
				- 조명이 사용하는 ShadowMap의 SRV 인덱스는 몇번인지 등등


-------------------------------------

진행 상황:
- Shadow를 동적으로 매 프레임마다 빛을 전달 받아, 프레임 리소스에 그림자에 필요한 정보를 저장하고 사용하는 구조로 설계 중


설계 방향: Light는 Shadow의 타입만 결정, 그 외에는 전부 동적으로 결정되고 사용됨
	- 매 프레임마다, 전달 받은 Light에 대한 ShadowMap 인덱스 할당 받고 사용하는 구조
	// ShadowMap 전용 버퍼를 3개의 타입 (Point, Directional, Spot)으로 생성하고, 텍스쳐 배열 타입으로 할당
	// 타입별 ShadowMap 전용 버퍼를 프레임 리소스에 맞게 생성 == 버퍼링 개수만큼 생성 
 

-> 그림자 셰도우맵 생성 및 바인딩 작성 완료. 
	- 오류 메시지 출력은 없는 상태
	- 일부 셰도우 맵이 제대로 생성 됬는지 출력하여 확인할 필요 있음
	- LightComponent Update 호출 시기를 TransformComponent와 순서를 정리할 필요가 있음 // Dirty Flag 순서 문제


셰도우맵에서 깊이를 불러오는 것과 Light의 월드 좌표계 복원에서 오류가 발생하는 듯 함 -> 좌표계 + 샘플링 오류였음

셰도우맵은 제대로 생성되고 있음 -> 이상 없음

샘플링 문제 해결 -> 아직 부자연스러움 -> 조명 거리 문제

조명의 Range에 따라 ShadowMap이 반영 안되고 있음 
조명의 월드 위치에 따라 ShadowMap이 결과가 달라지고 있음 // Range가 반영 안되고 있음. Range는 1000.0f 인데, 실제 체감 거리는 20.0f 정도로 느껴짐
조명과 일정 거리 멀어지면, Range와 관계 없이, 그림자가 생성 안됨
-> Projection 행렬 문제로 예상 되는 중

Projection 문제라고 생각하는 중
-> 그림자 구현 파이프라인 처음부터 다시 분석할 것
	// View, Proj 행렬, ShadowMap, Composite에서 제대로 된 좌표계/연산 방식으로 행렬 사용중인지 검토하기


+

조명 거리 문제는 Proj 행렬의 Near, Far 비율 문제였음, 비율에 차이가 커서, 분포에 의한 투영 오차 발생
-> Near, Far 조절 기능 추가 및 비율 재조정 기능 추가

하지만, Near, Far의 범위가 클수록 Far에 가까이 분포한 Depth들의 정밀도 하락 문제 지속됨
-> Reverse Z 방식을 채용

Reverse Z
- 투영 행렬 생성 시, Near, Far 의 값을 반대로 하여, 거리가 가까울수록 값이 1.0, 멀수록 0.0에 근사하도록 정규화된 결과 값을 반환
- 기존 방식의 Far 에 가까워질수록 정밀도 하락하던 문제가 Near로 전환됨 + Near은 정밀도가 낮아도 Far과 달리 큰 손실이 없음

-> Reverse Z 투영 방식을 통해 Near, Far 에 따른 정밀도 하락 문제를 보완하였음

-> Spot Light의 그림자 구현 완료
	- 아직 계단 현상이 남아 있음
		- 셰도우맵 크기를 키워보았으나, 문제 해결 안됨 
		- 샘플링의 정밀도 문제라고 판단
			- 월드좌표 복원 과정에서 생기는 정밀도 문제라고 생각하여, DepthStencil, ShadowMap 버퍼를 D32 구조로 수정
			-> 큰 변화는 아니지만 효과는 있었음




Point 조명 다시 구현해보기 // Reverse Z 방식을 채용하여, 문제가 해결됬는지 확인해야 함

+ Directional 조명에 CSM 방식 적용 구현 필요
	- CSM 구조 작성 및 동작 테스트 완료.
	-  AABB 컬링 구현 완료 // 제대로 컬링이 동작 되고 있는지, 테스트 필요
	- 각 Cascade 별 셰도우맵 생성 테스트 완료 // 색상별로 출력하여 디버깅 함
	- 영역이 적절한 비율로 할당 되었는지 검사 필요
	- 그림자 연산 필요
	- 프래임마다 모든 Cascade 를 렌더링하면 손해임 // 각 Cascade 를 프래임마다 1개 or 2개씩만 랜더링하도록 하기


+ ShadowMap을 매 프레임마다 생성하면, 문제가 많음 // 성능 저하 심각
	-> Component에 ShadowMap 프래임 동기화 bool 값 추가하기
		// 여유 있을 때, ShadowMap 컬링 추가하기	

+ Point/Spot 조명에 AABB 컬링 추가하기
+ 카메라 프러스텀 컬링 추가하기

장기적 목표


* Object 생성 기능 추가하기 // Window 메뉴 박스 활용하기
* Shader 핫리로드 기능 추가하기




